<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Food Detail</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin:0;
  font-family:Arial;
  background:#f9f9f9;
}

img {
  width:100%;
  height:260px;
  object-fit:cover;
}

.container {
  padding:15px;
}

h3 {
  margin-top:25px;
}

.option-group {
  margin-top:20px;
}

.option-row {
  display:flex;
  gap:10px;
  margin-top:10px;
}

.choice {
  flex:1;
  padding:14px;
  border-radius:12px;
  border:1px solid #ddd;
  background:white;
  text-align:center;
  cursor:pointer;
}

.choice.active {
  border:2px solid #111;
  background:#111;
  color:white;
}

.addon {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  border-radius:12px;
  border:1px solid #ddd;
  background:white;
  margin-top:10px;
  cursor:pointer;
}

.addon.active {
  border:2px solid #111;
}

.qty {
  display:flex;
  gap:20px;
  align-items:center;
  margin:20px 0;
}

button {
  padding:10px 16px;
}

.add {
  width:100%;
  background:#111;
  color:white;
  border:none;
  border-radius:12px;
  font-size:16px;
  padding:14px;
}
</style>
</head>

<body>

<img id="img">

<div class="container">
  <h2 id="name"></h2>
  <p id="code"></p>
  <p id="desc"></p>

  <div id="options"></div>

  <h3 id="price"></h3>

  <div class="qty">
    <button onclick="chg(-1)">âˆ’</button>
    <span id="qty">1</span>
    <button onclick="chg(1)">+</button>
  </div>

  <button class="add" onclick="addCart()">Add to Cart</button>
</div>

<script>
// ================= FOOD CONFIG =================
const FOOD_DATA = {
  A01: {
    name: "Chicken Burger",
    code: "A01",
    desc: "Juicy grilled chicken burger with fresh vegetables",
    img: "https://images.unsplash.com/photo-1606755962773-d324e0a13086",
    basePrice: 15,
    options: {
      choices: [
        { label: "Spicy Level", name: "spicy", values: ["Not Spicy", "Spicy"] },
        { label: "Egg", name: "egg", values: ["No Egg", "Egg"] },
        { label: "Lettuce", name: "lettuce", values: ["No Lettuce", "Lettuce"] }
      ],
      addons: [
        { name: "Extra Cheese", price: 2 },
        { name: "Extra Egg", price: 1 },
        { name: "Extra Black Pepper Sauce", price: 0.5 }
      ]
    }
  }
};

// ================= LOAD FOOD =================
const params = new URLSearchParams(location.search);
const code = params.get("code");
const food = FOOD_DATA[code];

if (!food) {
  document.body.innerHTML = "Food not found.";
  throw new Error("Invalid food code");
}

document.getElementById("img").src = food.img;
document.getElementById("name").innerText = food.name;
document.getElementById("code").innerText = food.code;
document.getElementById("desc").innerText = food.desc;

// ================= OPTIONS =================
const optionsDiv = document.getElementById("options");
let selectedChoices = {};
let selectedAddons = [];

// Choices
food.options.choices.forEach(group => {
  selectedChoices[group.name] = group.values[0];

  const groupDiv = document.createElement("div");
  groupDiv.className = "option-group";
  groupDiv.innerHTML = `<h3>${group.label}</h3>`;

  const row = document.createElement("div");
  row.className = "option-row";

  group.values.forEach((value, index) => {
    const box = document.createElement("div");
    box.className = "choice" + (index === 0 ? " active" : "");
    box.innerText = value;

    box.onclick = () => {
      selectedChoices[group.name] = value;
      row.querySelectorAll(".choice").forEach(c => c.classList.remove("active"));
      box.classList.add("active");
    };

    row.appendChild(box);
  });

  groupDiv.appendChild(row);
  optionsDiv.appendChild(groupDiv);
});

// Add-ons
const addonDiv = document.createElement("div");
addonDiv.className = "option-group";
addonDiv.innerHTML = "<h3>Add-ons</h3>";

food.options.addons.forEach(a => {
  const box = document.createElement("div");
  box.className = "addon";
  box.innerHTML = `<span>${a.name}</span><strong>+RM ${a.price}</strong>`;

  box.onclick = () => {
    box.classList.toggle("active");
    selectedAddons.includes(a)
      ? selectedAddons = selectedAddons.filter(x => x !== a)
      : selectedAddons.push(a);
    updatePrice();
  };

  addonDiv.appendChild(box);
});

optionsDiv.appendChild(addonDiv);

// ================= PRICE =================
let qty = 1;

function chg(n) {
  qty = Math.max(1, qty + n);
  document.getElementById("qty").innerText = qty;
  updatePrice();
}

function updatePrice() {
  let price = food.basePrice;
  selectedAddons.forEach(a => price += a.price);
  document.getElementById("price").innerText =
    "Total: RM " + (price * qty).toFixed(2);
}

updatePrice();

// ================= CART =================
function addCart() {
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");

  cart.push({
    code: food.code,
    name: food.name,
    qty,
    choices: selectedChoices,
    addons: selectedAddons.map(a => a.name),
    total: document.getElementById("price").innerText
  });

  localStorage.setItem("cart", JSON.stringify(cart));
  alert("Added to cart ðŸ›’");
  history.back();
}
</script>

</body>
</html>