<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Food Detail</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin:0;
  font-family:Arial;
  background:#f9f9f9;
}
img {
  width:100%;
  height:260px;
  object-fit:cover;
}
.container {
  padding:15px;
}
.qty {
  display:flex;
  gap:20px;
  align-items:center;
  margin:20px 0;
}
button {
  padding:10px 16px;
}
.add {
  width:100%;
  background:#111;
  color:white;
  border:none;
  border-radius:8px;
  font-size:16px;
}
.option-group {
  margin:15px 0;
}
</style>
</head>

<body>

<img id="img">

<div class="container">
  <h2 id="name"></h2>
  <p id="code"></p>
  <p id="desc"></p>

  <div id="options"></div>

  <h3 id="price"></h3>

  <div class="qty">
    <button onclick="chg(-1)">âˆ’</button>
    <span id="qty">1</span>
    <button onclick="chg(1)">+</button>
  </div>

  <button class="add" onclick="addCart()">Add to Cart</button>
</div>

<script>
// ================= FOOD CONFIG =================
const FOOD_DATA = {
  A01: {
    name: "Chicken Burger",
    code: "A01",
    desc: "Juicy grilled chicken burger with fresh vegetables",
    img: "https://images.unsplash.com/photo-1606755962773-d324e0a13086",
    basePrice: 15,
    options: {
      choices: [
        {
          label: "Spicy Level",
          name: "spicy",
          values: ["Not Spicy", "Spicy"]
        },
        {
          label: "Egg",
          name: "egg",
          values: ["No Egg", "Egg"]
        },
        {
          label: "Lettuce",
          name: "lettuce",
          values: ["No Lettuce", "Lettuce"]
        }
      ],
      addons: [
        { name: "Extra Cheese", price: 2 },
        { name: "Extra Egg", price: 1 },
        { name: "Extra Black Pepper Sauce", price: 0.5 }
      ]
    }
  }
};

// ================= LOAD FOOD =================
const params = new URLSearchParams(location.search);
const code = params.get("code");
const food = FOOD_DATA[code];

if (!food) {
  document.body.innerHTML = "Food not found.";
  throw new Error("Invalid food code");
}

document.getElementById("img").src = food.img;
document.getElementById("name").innerText = food.name;
document.getElementById("code").innerText = food.code;
document.getElementById("desc").innerText = food.desc;

// ================= OPTIONS UI =================
const optionsDiv = document.getElementById("options");

// Choices
food.options.choices.forEach(group => {
  const div = document.createElement("div");
  div.className = "option-group";
  div.innerHTML = `<strong>${group.label}</strong><br>`;

  group.values.forEach((v, i) => {
    div.innerHTML += `
      <label>
        <input type="radio"
               name="${group.name}"
               value="${v}"
               ${i === 0 ? "checked" : ""}
               onchange="updatePrice()">
        ${v}
      </label><br>
    `;
  });

  optionsDiv.appendChild(div);
});

// Add-ons
const addonDiv = document.createElement("div");
addonDiv.className = "option-group";
addonDiv.innerHTML = "<strong>Add-ons</strong><br>";

food.options.addons.forEach(a => {
  addonDiv.innerHTML += `
    <label>
      <input type="checkbox"
             data-price="${a.price}"
             onchange="updatePrice()">
      ${a.name} (+RM ${a.price})
    </label><br>
  `;
});

optionsDiv.appendChild(addonDiv);

// ================= PRICE LOGIC =================
let qty = 1;

function chg(n) {
  qty += n;
  if (qty < 1) qty = 1;
  document.getElementById("qty").innerText = qty;
  updatePrice();
}

function updatePrice() {
  let price = food.basePrice;

  document.querySelectorAll("input[type=checkbox]:checked")
    .forEach(cb => price += Number(cb.dataset.price));

  document.getElementById("price").innerText =
    "Total: RM " + (price * qty).toFixed(2);
}

updatePrice();

// ================= CART =================
function addCart() {
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");

  const selectedOptions = {};

  food.options.choices.forEach(group => {
    selectedOptions[group.name] =
      document.querySelector(`input[name="${group.name}"]:checked`).value;
  });

  const addons = [];
  document.querySelectorAll("input[type=checkbox]:checked")
    .forEach(cb => addons.push(cb.parentElement.innerText));

  cart.push({
    code: food.code,
    name: food.name,
    qty,
    options: selectedOptions,
    addons,
    price: document.getElementById("price").innerText
  });

  localStorage.setItem("cart", JSON.stringify(cart));
  alert("Added to cart ðŸ›’");
  history.back();
}
</script>

</body>
</html>